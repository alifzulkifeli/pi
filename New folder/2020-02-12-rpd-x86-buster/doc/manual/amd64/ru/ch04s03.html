<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>4.3. Подготовка файлов для загрузки с карты памяти USB</title>
<link rel="stylesheet" type="text/css" href="install.css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="index.html" title="Руководство по установке Debian GNU/Linux">
<link rel="up" href="ch04.html" title="Глава 4. Получение носителя с дистрибутивом">
<link rel="prev" href="ch04s02.html" title="4.2. Скачивание файлов с серверов-зеркал Debian">
<link rel="next" href="ch04s04.html" title="4.4. Подготовка файлов для загрузки с жёсткого диска">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">4.3. Подготовка файлов для загрузки с карты памяти USB</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch04s02.html"><img src="images/prev.png" alt="Пред."></a> </td>
<th width="60%" align="center">Глава 4. Получение носителя с дистрибутивом</th>
<td width="20%" align="right"> <a accesskey="n" href="ch04s04.html"><img src="images/next.png" alt="След."></a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title">
<a name="boot-usb-files"></a>4.3. Подготовка файлов для загрузки с карты памяти USB</h2></div></div></div>
<p>Для подготовки карты памяти USB вам нужна работающая система GNU/Linux с поддержкой USB. В этой системе карта памяти USB должна автоматически распознаваться при вставке. Если нет, то убедитесь, что загружен модуль ядра usb-storage. Когда USB-карта вставлена, то она доступна в системе как устройство с именем <code class="filename">/dev/sdX</code>, где <span class="quote">«<span class="quote">X</span>»</span> — это буква из диапазона a-z. Вы можете определить, какое устройство появилось после вставке карты USB запустив команду <span class="command"><strong>dmesg</strong></span>. Также выключите защиту от записи на карту. </p>
<div class="warning"><table border="0" summary="Warning">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Предупреждение]" src="images/warning.png"></td>
<th align="left">Предупреждение</th>
</tr>
<tr><td align="left" valign="top"><p>Процедура, описанная в этом разделе, уничтожит все данные на устройстве! Не ошибитесь в названии устройства карты памяти USB. Если вы укажите не то устройство, это может привести к полной потере информации где-то ещё, например, на жёстком диске. </p></td></tr>
</table></div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="usb-copy-isohybrid"></a>4.3.1. Подготовка карты памяти USB из гибридного образа CD или DVD</h3></div></div></div>
<p>Образы Debian CD и DVD могут быть непосредственно записаны на карту памяти USB; это самой лёгкий способ создать загрузочный USB. Просто выберите образ CD или DVD  (такие как netinst, CD-1, DVD-1 или netboot) подходящего размера для вашей карты памяти USB. О том, как получить образ CD или DVD, читайте <a class="xref" href="ch04s01.html" title="4.1. Официальный набор CD/DVD-ROM Debian GNU/Linux">Раздел 4.1, «Официальный набор CD/DVD-ROM Debian GNU/Linux»</a>. </p>
<p>Также, для очень маленьких карт памяти USB, с размером в несколько мегабайт, вы можете скачать образ <code class="filename">mini.iso</code> из каталога <code class="filename">netboot</code> (по ссылке, упомянутой в <a class="xref" href="ch04s02.html#where-files" title="4.2.1. Где искать установочные образы">Раздел 4.2.1, «Где искать установочные образы»</a>). </p>
<p>Выбранный вами образ CD или DVD должен быть записан прямо на карту памяти USB, что сотрёт её имеющееся содержимое. Например, из системы GNU/Linux, файл образа CD или DVD можно записать на карту памяти USB следующим образом (предварительно отмонтировав): </p>
<div class="informalexample"><pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>cp <em class="replaceable"><code>debian.iso</code></em> /dev/<em class="replaceable"><code>sdX</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sync</code></strong>
</pre></div>
<p> О том, как это сделать из других ОС можно найти в <a class="ulink" href="https://www.debian.org/CD/faq/index.en.html#write-usb" target="_top">Debian CD FAQ</a>. </p>
<div class="important"><table border="0" summary="Important">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Важно]" src="images/important.png"></td>
<th align="left">Важно</th>
</tr>
<tr><td align="left" valign="top"><p>Образ должен быть записан на устройство, представляющее весь диск, а не отдельный раздел, например /dev/sdb, а не /dev/sdb1. Не используйте программы типа <span class="command"><strong>unetbootin</strong></span>, которые изменяют образ. </p></td></tr>
</table></div>
<div class="important"><table border="0" summary="Important">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Важно]" src="images/important.png"></td>
<th align="left">Важно</th>
</tr>
<tr><td align="left" valign="top"><p>Такая простая операция записи образа CD или DVD на USB подойдёт большинству пользователей. Другие варианты, описанные далее, более сложны и предназначены для людей, у которых есть дополнительные требования. </p></td></tr>
</table></div>
<p>Гибридный образ занимает не всё место на карте, поэтому свободное пространство можно использовать для хранения файлов микропрограмм, пакетов или любых других ваших файлов. Это полезно, когда у вас есть только одна карта, или вы хотите сохранить всё необходимое на одном устройстве. </p>
<p>Создайте второй раздел FAT на карте, смонтируйте раздел и скопируйте или распакуйте на него микропрограмму. Пример: </p>
<div class="informalexample"><pre class="screen"># mount /dev/<em class="replaceable"><code>sdX2</code></em> /mnt
# cd /mnt
# tar zxvf <em class="replaceable"><code>/path/to/</code></em>firmware.tar.gz
# cd /
# umount /mnt
</pre></div>
<p>

</p>
<p>Вы можете записать <code class="filename">mini.iso</code> на карту памяти USB. В этом случае второй раздел создавать не нужно, он появится самостоятельно. После вытаскивания и повторной вставки карты памяти USB должно появиться два раздела. </p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="usb-copy-easy"></a>4.3.2. Копирование файлов на карту памяти USB вручную</h3></div></div></div>
<p>Ещё одним способом создания карты памяти USB является ручное копирование файлов программы установки и образа CD. Заметим, что карта памяти USB должна быть как минимум 1 ГБ (установка на меньший размер возможна после прочтения <a class="xref" href="ch04s03.html#usb-copy-flexible" title="4.3.3. Копирование файлов на карту памяти USB вручную — гибкий путь">Раздел 4.3.3, «Копирование файлов на карту памяти USB вручную — гибкий путь»</a>). </p>
<p>Существует файл "всё-в-одном" — <code class="filename">hd-media/boot.img.gz</code>, который содержит все файлы программы установки (включая ядро) <span class="phrase">, а также <span class="command"><strong>syslinux</strong></span> и его файл настройки</span> . </p>
<p>Заметим, что хотя этот метод удобен, он имеет большой недостаток: логический размер устройства ограничен 1 ГБ, даже если ёмкость карты памяти USB гораздо больше. Вам нужно переразметить карту USB и создать новые файловые системы, чтобы снова получить всё пространство, если вы хотите использовать его для другой цели. </p>
<p>Чтобы использовать образ, просто распакуйте его прямо на карту памяти USB: </p>
<div class="informalexample"><pre class="screen"># zcat boot.img.gz &gt; /dev/<em class="replaceable"><code>sdX</code></em>
</pre></div>
<p>

</p>
<p>После этого, смонтируйте карту памяти USB <span class="phrase">(<strong class="userinput"><code>mount /dev/<em class="replaceable"><code>sdX</code></em> /mnt</code></strong>),</span>  которая теперь имеет <span class="phrase">файловую систему FAT</span>  и скопируйте на неё ISO-образ Debian (netinst или полный CD). Размонтируйте устройство (<strong class="userinput"><code>umount /mnt</code></strong>) и всё готово. </p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="usb-copy-flexible"></a>4.3.3. Копирование файлов на карту памяти USB вручную — гибкий путь</h3></div></div></div>
<p>Если вам хочется большей гибкости или вы просто хотите знать, что на самом деле происходит, то можете воспользоваться следующим методом записи файлов на карту памяти. Преимущество использования этого метода в том, что если ёмкость карты USB достаточно велика, то вы можете скопировать любой образ ISO, даже DVD. </p>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm817"></a>4.3.3.1. Разметка карты памяти USB</h4></div></div></div>
<p>Мы покажем как использовать на карте памяти только первый раздел, а не всё устройство. </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Примечание]" src="images/note.png"></td>
<th align="left">Примечание</th>
</tr>
<tr><td align="left" valign="top">
<p>Так как большинство карт памяти USB продаются с единственным разделом FAT16, то вам, вероятно, не хочется переразмечать или переформатировать устройство. Если вам всё равно это нужно сделать, воспользуйтесь <span class="command"><strong>cfdisk</strong></span> или любой другой утилитой разметки для создания раздела FAT16<a href="#ftn.idm823" class="footnote" name="idm823"><sup class="footnote">[3]</sup></a>, настройте MBR с помощью </p>
<div class="informalexample"><pre class="screen">
# install-mbr /dev/<em class="replaceable"><code>sdX</code></em>
</pre></div>
<p> Команда <span class="command"><strong>install-mbr</strong></span>содержится в пакете Debian <code class="classname">mbr</code>. Затем создайте файловую систему: </p>
<div class="informalexample"><pre class="screen">
# mkdosfs /dev/<em class="replaceable"><code>sdX1</code></em>
</pre></div>
<p> Обязательно вводите правильное имя устройства карты памяти USB. Команда <span class="command"><strong>mkdosfs</strong></span> содержится в пакете Debian <code class="classname">dosfstools</code>. </p>
</td></tr>
</table></div>
<p>Для запуска ядра после загрузки с карты памяти USB, мы поместим на неё системный загрузчик. Хотя должен работать любой системный загрузчик (например, <span class="command"><strong>lilo</strong></span>), удобнее использовать <code class="classname">syslinux</code>, так как он использует раздел FAT16 и настраивается простым редактированием текстового файла. Для настройки системного загрузчика можно использовать любую операционную систему, которая поддерживает файловую систему FAT. </p>
<p>Чтобы поместить <code class="classname">syslinux</code> на раздел FAT16 карты памяти USB, установите в систему пакеты <code class="classname">syslinux</code> и <code class="classname">mtools</code> и введите </p>
<div class="informalexample"><pre class="screen">
# syslinux /dev/<em class="replaceable"><code>sdX1</code></em>
</pre></div>
<p> Ещё раз отметим: не ошибитесь в имени устройства. Раздел не должен быть смонтирован при запуске <span class="command"><strong>syslinux</strong></span>. Эта процедура записывает загрузочный сектор раздела и создаёт файл <code class="filename">ldlinux.sys</code>, который содержит код системного загрузчика. </p>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm848"></a>4.3.3.2. Добавление образа программы установки</h4></div></div></div>
<p>Смонтировав раздел (<strong class="userinput"><code>mount /dev/<em class="replaceable"><code>sdX1</code></em> /mnt</code></strong>), скопируйте следующие файлы образа программы установки на карту памяти: </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p> <code class="filename">vmlinuz</code> или <code class="filename">linux</code> (файл ядра) </p></li>
<li class="listitem"><p> <code class="filename">initrd.gz</code> (образ ramdisk) </p></li>
</ul></div>
<p> Вы можете выбрать текстовую версию программы установки или версию с графическим интерфейсом. Последнюю можно найти в подкаталоге <code class="filename">gtk</code>. Если вы хотите переименовать файлы, учтите, что <code class="classname">syslinux</code> работает только с файловыми именами DOS (8.3). </p>
<p>Затем, вам нужно создать файл настройки <code class="filename">syslinux.cfg</code>, который, как минимум, должен содержать следующую строку (измените имя файла с ядром на <span class="quote">«<span class="quote"><code class="filename">linux</code></span>»</span>, если используется образ <code class="filename">netboot</code>): </p>
<div class="informalexample"><pre class="screen">
default vmlinuz initrd=initrd.gz
</pre></div>
<p> Для графической версии программы установки нужно добавить в строку <strong class="userinput"><code>vga=788</code></strong>. По желанию, можно добавлять и другие параметры. </p>
<p>Чтобы включить выдачу приглашения при загрузке для добавления дополнительных параметров, добавьте строку <strong class="userinput"><code>prompt 1</code></strong>. </p>
<p>Если вы используете образ <code class="filename">hd-media</code>, то теперь должны скопировать файл ISO с образом Debian<a href="#ftn.idm875" class="footnote" name="idm875"><sup class="footnote">[4]</sup></a> на карту памяти. После завершения, размонтируйте карту памяти USB (<strong class="userinput"><code>umount /mnt</code></strong>). </p>
</div>
</div>
<div class="footnotes">
<br><hr width="100" align="left">
<div id="ftn.idm823" class="footnote"><p><a href="#idm823" class="para"><sup class="para">[3] </sup></a>Не забудьте установить флаг загрузки <span class="quote">«<span class="quote">bootable</span>»</span>.</p></div>
<div id="ftn.idm875" class="footnote"><p><a href="#idm875" class="para"><sup class="para">[4] </sup></a>Вы можете использовать netinst или полный образ CD (см. <a class="xref" href="ch04s01.html" title="4.1. Официальный набор CD/DVD-ROM Debian GNU/Linux">Раздел 4.1, «Официальный набор CD/DVD-ROM Debian GNU/Linux»</a>). Убедитесь, что он подходит по размеру. Заметим, что образ <span class="quote">«<span class="quote">netboot <code class="filename">mini.iso</code></span>»</span> не подходит для этой цели. </p></div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch04s02.html"><img src="images/prev.png" alt="Пред."></a> </td>
<td width="20%" align="center"><a accesskey="u" href="ch04.html"><img src="images/up.png" alt="Наверх"></a></td>
<td width="40%" align="right"> <a accesskey="n" href="ch04s04.html"><img src="images/next.png" alt="След."></a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">4.2. Скачивание файлов с серверов-зеркал Debian </td>
<td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="Начало"></a></td>
<td width="40%" align="right" valign="top"> 4.4. Подготовка файлов для загрузки с жёсткого диска</td>
</tr>
</table>
</div>
</body>
</html>
