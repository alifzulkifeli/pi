<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>4.3. 为从 U 盘引导准备文件</title>
<link rel="stylesheet" type="text/css" href="install.css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="index.html" title="Debian GNU/Linux 安装手册">
<link rel="up" href="ch04.html" title="第 4 章 获取系统安装介质">
<link rel="prev" href="ch04s02.html" title="4.2. 从 Debian 镜像服务器下载文件">
<link rel="next" href="ch04s04.html" title="4.4. 为从硬盘引导准备文件">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">4.3. 为从 U 盘引导准备文件</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch04s02.html"><img src="images/prev.png" alt="上一页"></a> </td>
<th width="60%" align="center">第 4 章 获取系统安装介质</th>
<td width="20%" align="right"> <a accesskey="n" href="ch04s04.html"><img src="images/next.png" alt="下一页"></a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title">
<a name="boot-usb-files"></a>4.3. 为从 U 盘引导准备文件</h2></div></div></div>
<p>为了准备 U 盘，您需要一台运行的支持 USB 的 GNU/Linux 系统。当前的 GNU/Linux 系统会在您插入 U 盘的时候自动识别。如果没有，您应该确认 usb-storage 内核模块是否已经被加载。U 盘插入后，它将被映射到名为 <code class="filename">/dev/sdX</code> 的设备，其中的 <span class="quote">“<span class="quote">X</span>”</span> 是 a-z 的字母。您可以通过运行 <span class="command"><strong>dmesg</strong></span> 在插入 U 盘后确认是否被正确映射。要写入信息，请要先打开它上面的写保护开关。 </p>
<div class="warning"><table border="0" summary="Warning">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td>
<th align="left">警告</th>
</tr>
<tr><td align="left" valign="top"><p>采用这种方法将销毁设备上已有的任何内容！请确认您使用了正确的 U 盘设备名。如果搞错，比如写成硬盘，将造成该设备上的所有信息丢失。 </p></td></tr>
</table></div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="usb-copy-isohybrid"></a>4.3.1. 使用混合 CD 或 DVD 映像制作 U 盘</h3></div></div></div>
<p>Debian CD and DVD images can now be written directly to a USB stick, which is a very easy way to make a bootable USB stick. Simply choose a CD or DVD image (such as the netinst, CD-1, DVD-1, or netboot) that will fit on your USB stick. See <a class="xref" href="ch04s01.html" title="4.1. 官方的 Debian GNU/Linux CD/DVD 光盘套装">第 4.1 节 “官方的 Debian GNU/Linux CD/DVD 光盘套装”</a> to get a CD or DVD image. </p>
<p>另外，对于只有几 M 的小容量 U 盘，您可以从 <code class="filename">netboot</code> 目录下载 <code class="filename">mini.iso</code> 映像(位于 <a class="xref" href="ch04s02.html#where-files" title="4.2.1. 在哪里能找到安装映像">第 4.2.1 节 “在哪里能找到安装映像”</a>)。 </p>
<p>The CD or DVD image you choose should be written directly to the USB stick, overwriting its current contents. For example, when using an existing GNU/Linux system, the CD or DVD image file can be written to a USB stick as follows, after having made sure that the stick is unmounted: </p>
<div class="informalexample"><pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>cp <em class="replaceable"><code>debian.iso</code></em> /dev/<em class="replaceable"><code>sdX</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sync</code></strong>
</pre></div>
<p> Information about how to do this on other operating systems can be found in the <a class="ulink" href="https://www.debian.org/CD/faq/index.en.html#write-usb" target="_top">Debian CD FAQ</a>. </p>
<div class="important"><table border="0" summary="Important">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td>
<th align="left">重要</th>
</tr>
<tr><td align="left" valign="top"><p>The image must be written to the whole-disk device and not a partition, e.g. /dev/sdb and not /dev/sdb1. Do not use tools like <span class="command"><strong>unetbootin</strong></span> which alter the image. </p></td></tr>
</table></div>
<div class="important"><table border="0" summary="Important">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td>
<th align="left">重要</th>
</tr>
<tr><td align="left" valign="top"><p>对大多数用户来说，简单地把 CD 或 DVD 映像写入 U 盘已经够用。下面更为复杂的选项主要提供给有特殊需要的用户。 </p></td></tr>
</table></div>
<p>The hybrid image on the stick does not occupy all the storage space, so it may be worth considering using the free space to hold firmware files or packages or any other files of your choice. This could be useful if you have only one stick or just want to keep everything you need on one device. </p>
<p>Create a second, FAT partition on the stick, mount the partition and copy or unpack the firmware onto it. For example: </p>
<div class="informalexample"><pre class="screen"># mount /dev/<em class="replaceable"><code>sdX2</code></em> /mnt
# cd /mnt
# tar zxvf <em class="replaceable"><code>/path/to/</code></em>firmware.tar.gz
# cd /
# umount /mnt
</pre></div>
<p>

</p>
<p>You might have written the <code class="filename">mini.iso</code> to the USB stick. In this case the second partition doesn't have to be created as, very nicely, it will already be present. Unplugging and replugging the USB stick should make the two partitions visible. </p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="usb-copy-easy"></a>4.3.2. 手动复制文件到 U 盘。</h3></div></div></div>
<p>另一种方法制作 U 盘是手动复制安装文件和 CD 映像。注意 U 盘最小容量为 1 GB (也可以使用较少容量，请参考 <a class="xref" href="ch04s03.html#usb-copy-flexible" title="4.3.3. 手动复制文件到 U 盘 — 灵活的方法">第 4.3.3 节 “手动复制文件到 U 盘 — 灵活的方法”</a>)。 </p>
<p>有一个文件合集 <code class="filename">hd-media/boot.img.gz</code> 包含所有的安装程序文件(包括内核) <span class="phrase">以及 <code class="classname">syslinux</code> 和对应的配置文件</span> 。 </p>
<p>需要注意的是，虽然方便，但该方法有一个主要缺点：即使 U 盘容量更大，该设备的逻辑尺寸还是限制在 1 GB。如果您要该 U 盘作其他用途，需要为它重新分区，为剩余容量创建一个新的文件系统。 </p>
<p>使用该映象只须将它直接解压到 U 盘： </p>
<div class="informalexample"><pre class="screen"># zcat boot.img.gz &gt; /dev/<em class="replaceable"><code>sdX</code></em>
</pre></div>
<p>

</p>
<p>然后，挂载 U 盘 <span class="phrase">(<strong class="userinput"><code>mount /dev/<em class="replaceable"><code>sdX</code></em> /mnt</code></strong>),</span>  现在上面有了 <span class="phrase">一个 FAT 文件系统</span> ，然后复制 Debian ISO 映像 (netinst 或完整的 CD) 到里面。卸载 U 盘 (<strong class="userinput"><code>umount /mnt</code></strong>) 就完成了。 </p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="usb-copy-flexible"></a>4.3.3. 手动复制文件到 U 盘 — 灵活的方法</h3></div></div></div>
<p>If you like more flexibility or just want to know what's going on, you should use the following method to put the files on your stick. One advantage of using this method is that — if the capacity of your USB stick is large enough — you have the option of copying any ISO image, even a DVD image, to it. </p>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm818"></a>4.3.3.1. 给 U 盘分区</h4></div></div></div>
<p>我们将展示如何使用 U 盘的第一个分区，而不是整个设备。 </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/note.png"></td>
<th align="left">注意</th>
</tr>
<tr><td align="left" valign="top">
<p>由于大多数 U 盘预先设置了一个单独的 FAT16 分区，您可能不需要重新分区或者格式化 U 盘。如果必须要做，请使用 <span class="command"><strong>cfdisk</strong></span> 或者其他的分区工具来创建一个 FAT16 分区<a href="#ftn.idm824" class="footnote" name="idm824"><sup class="footnote">[3]</sup></a>，安装 MBR 使用：</p>
<div class="informalexample"><pre class="screen">
# install-mbr /dev/<em class="replaceable"><code>sdX</code></em>
</pre></div>
<p> 其中 <span class="command"><strong>install-mbr</strong></span> 命令包含在 <code class="classname">mbr</code> Debian 软件包内。然后建立文件系统：</p>
<div class="informalexample"><pre class="screen">
# mkdosfs /dev/<em class="replaceable"><code>sdX1</code></em>
</pre></div>
<p> 注意，请使用 U 盘正确的设备名称。<span class="command"><strong>mkdosfs</strong></span> 命令包含在 <code class="classname">dosfstools</code> Debian 软件包内。 </p>
</td></tr>
</table></div>
<p>为了在 U 盘引导后启动内核，我们要在 U 盘上放入一个 boot loader。尽管任何 boot loader (比如 <code class="classname">lilo</code>)都应该可以胜任，不过还是使用 <code class="classname">syslinux</code> 更方便。主要原因是它可以使用 FAT16 分区，而且只需要编辑一个文本文件就能对其进行配置。任何支持 FAT 文件系统的操作系统都可以用来改变 boot loader 的配置文件。 </p>
<p>为了把 <code class="classname">syslinux</code> 放到 U 盘的 FAT16 分区上，请在您的系统中安装 <code class="classname">syslinux</code> 和 <code class="classname">mtools</code> 软件包，然后执行：</p>
<div class="informalexample"><pre class="screen">
# syslinux /dev/<em class="replaceable"><code>sdX1</code></em>
</pre></div>
<p> 再提醒一次，请确认您使用的是正确的设备名称。启动 <span class="command"><strong>syslinux</strong></span> 的时候该分区不能被挂载，因为该过程会向分区的引导扇区写入数据，并且创建包含 boot loader 代码的 <code class="filename">ldlinux.sys</code> 文件。 </p>
</div>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="idm849"></a>4.3.3.2. 添加安装程序映像</h4></div></div></div>
<p>Mount the partition (<strong class="userinput"><code>mount /dev/<em class="replaceable"><code>sdX1</code></em> /mnt</code></strong>) and copy the following installer image files to the stick: </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p> <code class="filename">vmlinuz</code> or <code class="filename">linux</code> (kernel binary) </p></li>
<li class="listitem"><p> <code class="filename">initrd.gz</code> (initial ramdisk image) </p></li>
</ul></div>
<p> You can choose between either the text-based or the graphical version of the installer. The latter can be found in the <code class="filename">gtk</code> subdirectory. If you want to rename the files, please note that <code class="classname">syslinux</code> can only process DOS (8.3) file names. </p>
<p>Next you should create a <code class="filename">syslinux.cfg</code> configuration file, which at a bare minimum should contain the following line (change the name of the kernel binary to <span class="quote">“<span class="quote"><code class="filename">linux</code></span>”</span> if you used a <code class="filename">netboot</code> image): </p>
<div class="informalexample"><pre class="screen">
default vmlinuz initrd=initrd.gz
</pre></div>
<p> For the graphical installer you should add <strong class="userinput"><code>vga=788</code></strong> to the line. Other parameters can be appended as desired. </p>
<p>添加 <strong class="userinput"><code>prompt 1</code></strong> 一行，使得引导提示符可以允许附加参数。 </p>
<p>如果您使用 <code class="filename">hd-media</code> 映象，现在应该复制 Debian ISO 映像文件<a href="#ftn.idm876" class="footnote" name="idm876"><sup class="footnote">[4]</sup></a> 到 U 盘。完成后，卸载 U 盘 (<strong class="userinput"><code>umount /mnt</code></strong>)。 </p>
</div>
</div>
<div class="footnotes">
<br><hr width="100" align="left">
<div id="ftn.idm824" class="footnote"><p><a href="#idm824" class="para"><sup class="para">[3] </sup></a> 别忘记设置 <span class="quote">“<span class="quote">bootable</span>”</span> 引导标记。</p></div>
<div id="ftn.idm876" class="footnote"><p><a href="#idm876" class="para"><sup class="para">[4] </sup></a> 您可以选择 netinst 或完整 CD 映像 (参阅 <a class="xref" href="ch04s01.html" title="4.1. 官方的 Debian GNU/Linux CD/DVD 光盘套装">第 4.1 节 “官方的 Debian GNU/Linux CD/DVD 光盘套装”</a>)。确认选择合适的映象。注意 <span class="quote">“<span class="quote">netboot <code class="filename">mini.iso</code></span>”</span> 映象在这里并不适用。</p></div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch04s02.html"><img src="images/prev.png" alt="上一页"></a> </td>
<td width="20%" align="center"><a accesskey="u" href="ch04.html"><img src="images/up.png" alt="上一级"></a></td>
<td width="40%" align="right"> <a accesskey="n" href="ch04s04.html"><img src="images/next.png" alt="下一页"></a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">4.2. 从 Debian 镜像服务器下载文件 </td>
<td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="起始页"></a></td>
<td width="40%" align="right" valign="top"> 4.4. 为从硬盘引导准备文件</td>
</tr>
</table>
</div>
</body>
</html>
